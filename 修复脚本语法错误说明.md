# 修复脚本语法错误

## 问题

在修改"点击下载对应的图片"节点的脚本时，由于JSON字符串转义的问题，导致语法错误：
```
SyntaxError: Invalid or unexpected token
```

## 原因

在JSON字符串中，JavaScript代码里的字符串引号需要正确转义。当JavaScript代码中使用双引号时，在JSON中需要转义为 `\"`，但由于JSON字符串本身也需要转义，所以变成了 `\\\"`，这可能导致转义混乱。

## 解决方案

在JavaScript代码中使用**单引号**包裹选择器字符串，这样在JSON中就不需要转义双引号了。

## 修复后的脚本

在"点击下载对应的图片"节点的 `jsonBody` 中，将 `script` 字段修改为：

```json
"script": "try { const name = args.targetName.trim(); const allNames = Array.from(document.querySelectorAll(\"div[class*='text-ellipsis'][class*='font-semibold']\")); const targetEl = allNames.find(el => el.textContent.trim() === name); if (!targetEl) return { status: 'fail', msg: 'Name not found' }; const btn = targetEl.parentElement.nextElementSibling.querySelector('button'); if (btn) { btn.parentElement.style.visibility='visible'; btn.click(); return { status: 'success' }; } return { status: 'fail', msg: 'Btn not found' }; } catch(e) { return { status: 'error', msg: e.toString() }; }"
```

**关键修改**：
- 将 `document.querySelectorAll('.text-ellipsis')` 
- 改为 `document.querySelectorAll(\"div[class*='text-ellipsis'][class*='font-semibold']\")`
- 注意：外层使用双引号（需要转义为 `\"`），内层使用单引号（不需要转义）

## 完整的jsonBody（格式化后）

```json
{
  "tabId": {{ $('检查是否存在需要下载结果的Tab').item.json.tab_id }},
  "world": "MAIN",
  "args": { "targetName": "{{ $json.title }}" },
  "script": "try { const name = args.targetName.trim(); const allNames = Array.from(document.querySelectorAll(\"div[class*='text-ellipsis'][class*='font-semibold']\")); const targetEl = allNames.find(el => el.textContent.trim() === name); if (!targetEl) return { status: 'fail', msg: 'Name not found' }; const btn = targetEl.parentElement.nextElementSibling.querySelector('button'); if (btn) { btn.parentElement.style.visibility='visible'; btn.click(); return { status: 'success' }; } return { status: 'fail', msg: 'Btn not found' }; } catch(e) { return { status: 'error', msg: e.toString() }; }"
}
```

## 在n8n中的实际配置

在n8n的节点配置中，`jsonBody` 字段应该填写（注意转义）：

```
={
  "tabId": {{ $('检查是否存在需要下载结果的Tab').item.json.tab_id }},
  "world": "MAIN",
  "args": { "targetName": "{{ $json.title }}" },
  "script": "try { const name = args.targetName.trim(); const allNames = Array.from(document.querySelectorAll(\"div[class*='text-ellipsis'][class*='font-semibold']\")); const targetEl = allNames.find(el => el.textContent.trim() === name); if (!targetEl) return { status: 'fail', msg: 'Name not found' }; const btn = targetEl.parentElement.nextElementSibling.querySelector('button'); if (btn) { btn.parentElement.style.visibility='visible'; btn.click(); return { status: 'success' }; } return { status: 'fail', msg: 'Btn not found' }; } catch(e) { return { status: 'error', msg: e.toString() }; }"
}
```

注意：在n8n的表达式编辑器中，双引号会自动转义，所以直接使用 `\"` 即可。
