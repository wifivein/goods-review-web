version: '3.8'

services:
  backend:
    build:
      context: ..
      dockerfile: docker/Dockerfile.backend
    container_name: goods_review_backend
    # 移除端口映射，统一通过 nginx (8080) 访问
    # ports:
    #   - "5001:5000"
    environment:
      - DB_HOST=${DB_HOST:-172.17.0.1}
      - DB_PORT=${DB_PORT:-3307}
      - DB_USER=${DB_USER:-root}
      - DB_PASSWORD=${DB_PASSWORD:-root}
      - DB_NAME=${DB_NAME:-temu_baodan}
      - SAVE_API_URL=${SAVE_API_URL:-http://temebaodan.all369.cn/api/pc/savegoods}
      - BIGMODEL_API_KEY=${BIGMODEL_API_KEY:-}
      - COS_SECRET_ID=${COS_SECRET_ID:-}
      - COS_SECRET_KEY=${COS_SECRET_KEY:-}
      - COS_REGION=${COS_REGION:-ap-beijing}
      - COS_BUCKET=${COS_BUCKET:-}
      - COS_DOMAIN=${COS_DOMAIN:-}
    volumes:
      - ../backend:/app
    restart: unless-stopped
    networks:
      - goods_review_network

  frontend:
    image: nginx:alpine
    container_name: goods_review_frontend
    ports:
      - "8080:80"
    volumes:
      - ../frontend:/usr/share/nginx/html:ro
      - /opt/product_images:/usr/share/nginx/html/product_images:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
    networks:
      - goods_review_network
    depends_on:
      - backend

networks:
  goods_review_network:
    driver: bridge
